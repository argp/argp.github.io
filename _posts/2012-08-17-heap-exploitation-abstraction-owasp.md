---
id: 634
title: 'Heap Exploitation Abstraction by Example &#8211; OWASP AppSec Research 2012'
author: argp
layout: post
guid: http://sysc.tl/?p=634
permalink: /2012/08/17/heap-exploitation-abstraction-owasp/
aktt_notify_twitter:
  - no
categories:
  - exploitation
  - research
tags:
  - abstraction
  - exploitation
  - jemalloc
  - kernel heap
  - owasp
  - research
  - slub
  - uma
  - userland heap
---
This year&#8217;s [OWASP AppSec Research][1] conference took place in Athens, Greece and we were planning to be there as participants. However, the day before the conference, Konstantinos Papapanagiotou (General Chair) asked if we could do a presentation to replace a cancelled talk. Myself and Chariton Karamitas agreed to help and spend around three hours preparing a talk on heap exploitation abstraction, a subject dear to us.

[<img src="http://sysc.tl/wp-content/uploads/2012/08/heap_weird_machine-300x138.png" alt="" title="heap_weird_machine" width="300" height="138" class="aligncenter size-medium wp-image-636" />][2]

Our talk was titled [&#8220;Heap Exploitation Abstraction by Example&#8221;][3] and was divided into two main parts. In the first part we focused on presenting examples of exploiting heap managers. Specifically, we talked about attacking the FreeBSD kernel allocator (UMA), the Linux kernel allocator (SLUB) and the jemalloc userland allocator.

In the second part we started by finding the common elements of these three allocators and categorizing them into the following:

  * End-user allocations
  * Allocation containers
  * Container groupings
  * Execution-specific (thread, CPU core) metadata

We then proceeded to make an argument that the value of abstracting heap exploitation is in having a library of attack techniques, or *primitives*, that can be reused on other allocators. We took the concept of *weird machines* as defined by Sergey Bratus and Halvar Flake and applied it to heap managers. Briefly, we consider an allocator to be a deterministic automaton. Metadata corruption attacks can then be viewed as corruptions of the automaton&#8217;s transition function. Application-specific attacks, like adjacent memory region corruptions, can be viewed as manipulations of the automaton&#8217;s determinacy.

Please consider this as our early attempt on abstracting heap exploitation (also that it was put together in three hours) and expect more work on the subject from us.

Presentation Material

  * Slides ([pdf][3])

Thanks to: Sergey Bratus and Halvar Flake for the weird machine concept; Chris Valasek and Yiorgos Adamopoulos for interesting discussions on exploitation abstraction; Konstantinos Papapanagiotou for inviting us to replace the cancelled talk.

 [1]: http://www.appsecresearch.org/
 [2]: http://sysc.tl/wp-content/uploads/2012/08/heap_weird_machine.png
 [3]: http://census-labs.com/media/heap-owasp-appsec-2012.pdf