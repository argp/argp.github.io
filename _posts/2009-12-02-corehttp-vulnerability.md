---
id: 154
title: CoreHTTP web server off-by-one buffer overflow vulnerability
author: argp
layout: post
guid: http://argp.gr/blog/?p=154
permalink: /2009/12/02/corehttp-vulnerability/
aktt_notify_twitter:
  - no
categories:
  - advisories
  - exploitation
  - research
  - security
tags:
  - advisories
  - census
  - corehttp
  - exploit
  - exploitation
  - research
  - security
---
<table>
  <tr>
    <td>
      census ID:
    </td>
    
    <td>
      census-2009-0003
    </td>
  </tr>
  
  <tr>
    <td>
      CVE ID:
    </td>
    
    <td>
      <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3586">CVE-2009-3586</a>
    </td>
  </tr>
  
  <tr>
    <td>
      Affected Products:
    </td>
    
    <td>
      CoreHTTP web server versions &le; 0.5.3.1.
    </td>
  </tr>
  
  <tr>
    <td>
      Class:
    </td>
    
    <td>
      Improper Input Validation (<a href="http://cwe.mitre.org/data/definitions/20.html">CWE-20</a>), Failure to Constrain Operations within the Bounds of a Memory Buffer (<a href="http://cwe.mitre.org/data/definitions/119.html">CWE-119</a>)
    </td>
  </tr>
  
  <tr>
    <td>
      Remote:
    </td>
    
    <td>
      Yes
    </td>
  </tr>
  
  <tr>
    <td>
      Discovered by:
    </td>
    
    <td>
      Patroklos Argyroudis
    </td>
  </tr>
</table>

We have discovered a remotely exploitable &#8220;improper input validation&#8221; vulnerability in the CoreHTTP web server that leads to an off-by-one stack buffer overflow. The vulnerability can lead to denial of service attacks against the web server and potentially to the remote execution of arbitrary code with the privileges of the user running the server.

### Details

[CoreHTTP][1] is a minimalist web server focusing on speed and size. More information about its features can be found [here][2].

CoreHTTP (up to and including version 0.5.3.1) employs an insufficient input validation method for handling HTTP requests with invalid method names and URIs. Specifically, the vulnerability is an off-by-one buffer overflow in the `sscanf()` call at file `src/http.c` line numbers 45 and 46:

<div class="wp_syntax">
  <table>
    <tr>
      <td class="line_numbers">
        <pre>45
46
</pre>
      </td>
      
      <td class="code">
        <pre class="c" style="font-family:monospace;"><span style="color: #000066;">sscanf</span><span style="color: #009900;">&#40;</span>parentsprock<span style="color: #339933;">-&gt;</span>buffer<span style="color: #339933;">,</span>
       <span style="color: #ff0000;">"%"</span> PATHSIZE_S <span style="color: #ff0000;">"[A-Za-z] %"</span> PATHSIZE_S <span style="color: #ff0000;">"s%*[ <span style="color: #000099; font-weight: bold;">\t</span><span style="color: #000099; font-weight: bold;">\n</span>]"</span><span style="color: #339933;">,</span> req<span style="color: #339933;">,</span> url<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre>
      </td>
    </tr>
  </table>
</div>

The buffers `req` and `url` are declared to be of size 256 bytes (`PATHSIZE`) and the `sscanf()` call writes 256 bytes (`PATHSIZE_S`) to these buffers without NULL terminating them.

Note that this is not vulnerability [CVE-2007-4060][3] in which the same `sscanf()` call contained no bounds check at all.

This vulnerability can lead to denial of service attacks against the CoreHTTP web server and potentially to the remote execution of arbitrary code with the privileges of the user running the server. We have developed [a proof-of-concept exploit][4] to demonstrate the vulnerability.

To address the problem we propose the following unofficial patch (download it from [here][5]), since CoreHTTP&#8217;s author has not released an official fix yet:

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="c" style="font-family:monospace;"><span style="color: #339933;">---</span> corehttp<span style="color: #339933;">/</span>src<span style="color: #339933;">/</span>common.<span style="color: #202020;">h</span>.<span style="color: #202020;">orig</span>  <span style="color: #0000dd;">2009</span><span style="color: #339933;">-</span><span style="color: #0000dd;">12</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span> <span style="color:#800080;">09</span><span style="color: #339933;">:</span><span style="color: #0000dd;">29</span><span style="color: #339933;">:</span><span style="color:#800080;">18.000000000</span> <span style="color: #339933;">+</span><span style="color: #208080;">0200</span>
<span style="color: #339933;">+++</span> corehttp<span style="color: #339933;">/</span>src<span style="color: #339933;">/</span>common.<span style="color: #202020;">h</span>       <span style="color: #0000dd;">2009</span><span style="color: #339933;">-</span><span style="color: #0000dd;">12</span><span style="color: #339933;">-</span><span style="color: #208080;">01</span> <span style="color:#800080;">09</span><span style="color: #339933;">:</span><span style="color: #0000dd;">31</span><span style="color: #339933;">:</span><span style="color:#800080;">47.000000000</span> <span style="color: #339933;">+</span><span style="color: #208080;">0200</span>
@@ <span style="color: #339933;">-</span><span style="color: #0000dd;">36</span><span style="color: #339933;">,</span><span style="color: #0000dd;">7</span> <span style="color: #339933;">+</span><span style="color: #0000dd;">36</span><span style="color: #339933;">,</span><span style="color: #0000dd;">7</span> @@
 <span style="color: #339933;">#define BUFSIZE                2048</span>
 <span style="color: #339933;">#define BUFSIZE_S      "2048"</span>
 <span style="color: #339933;">#define PATHSIZE       256</span>
<span style="color: #339933;">-</span><span style="color: #339933;">#define PATHSIZE_S     "256"</span>
<span style="color: #339933;">+</span><span style="color: #339933;">#define PATHSIZE_S     "255"</span>
 <span style="color: #339933;">#define        SETSIZE         16</span>
&nbsp;
 <span style="color: #339933;">#ifndef GLOBALS_DEFINED</span></pre>
      </td>
    </tr>
  </table>
</div>

 [1]: http://corehttp.sourceforge.net/
 [2]: http://corehttp.sourceforge.net/man.html
 [3]: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-4060
 [4]: http://census-labs.com/media/corex.txt
 [5]: http://census-labs.com/media/corehttp-0.5.3.1-patch.txt